# Base reference: https://docs.conan.io/en/latest/integrations/ci/travisci.html
os: linux
language: python
python: "3.7"
dist: bionic
cache:
  directories:
    - $HOME/.conan/data
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - sourceline: 'deb https://apt.kitware.com/ubuntu/ bionic main'
        key_url: 'https://apt.kitware.com/keys/kitware-archive-latest.asc'
    packages:
      - gcc-9
      - g++-9
      - cmake
      - ninja-build
      - alsa-utils
      - libgrpc++-dev 
      - protobuf-compiler-grpc
    env:
      - COMPILER_EVAL="CC=gcc-9 && CXX=g++-9"
before_install:
    - eval "${COMPILER_EVAL}"
install:
  - pip install conan
  - conan user
script:
  - mkdir build
  - cd build
  - cmake .. -G "Ninja" > /dev/null # Do configuration quietly, Travis-CI complains about large log files
  - cmake --build .
  - ctest -E "USER_INPUT|REQUIRES_SERVER" .